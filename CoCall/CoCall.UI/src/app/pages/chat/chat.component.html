<app-header></app-header>
<div class="main-container">
  <!-- Left sidebar with chat list -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="user-profile">
        <div class="avatar">
          <mat-icon>person</mat-icon>
        </div>
        <span class="username">My Profile</span>
      </div>
    </div>

    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label><span class="page-tab">Search or start new chat</span></mat-label>
        <input matInput (input)="onSearch($event)" />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <!-- Search Results Dropdown -->
      <div class="search-results" *ngIf="searchResults.length > 0">
        <div class="search-result-item" *ngFor="let result of searchResults" (click)="createNewChat(result)">
          <div class="avatar search-avatar">
            <mat-icon>person</mat-icon>
          </div>
          <div class="search-info">
            <div class="search-name">{{ result.name }}</div>
            <div class="search-username"> {{ '@'+result.userName }}</div>
          </div>
          <div class="search-action">
            <mat-icon>chat</mat-icon>
          </div>
        </div>
      </div>
    </div>

    <div class="content-list">
      <div class="list-item" *ngFor="let chat of activeChats" (click)="openChat(chat)" [class.active]="selectedChat?.id === chat.id">
        <div class="avatar chat-avatar">
          <mat-icon>person</mat-icon>
        </div>
        <div class="list-info">
          <div class="list-name">{{ chat.name }}</div>
          <div class="list-preview">{{ chat.messages[chat.messages.length - 1]?.message || 'No messages' }}</div>
        </div>
        <!-- Unread message badge -->
        <div class="unread-badge" *ngIf="chat.unreadCount && chat.unreadCount > 0">
          {{ chat.unreadCount > 99 ? '99+' : chat.unreadCount }}
        </div>
      </div>
    </div>
  </div>

  <!-- Main chat area -->
  <div class="main-content" *ngIf="selectedChat">
    <div class="content-header">
      <div class="user-profile">
        <div class="avatar">
          <mat-icon>person</mat-icon>
        </div>
        <div class="contact-info">
          <div class="contact-name">{{ selectedChat.name }}</div>
          <div class="contact-status">online</div>
        </div>
      </div>
    </div>

    <div class="content-body messages-container">
      <div class="messages-wrapper">
        <div *ngFor="let message of selectedChat.messages"
             class="message"
             [class.sent]="message.senderId === user.id"
             [class.received]="message.receiverId === user.id">
          <div class="message-content">
            <div class="message-text">{{ message.message }}</div>
            <div class="message-time">{{ message.timestamp | date:' HH:mm' }}</div>
          </div>
          <!-- Read status indicator for sent messages -->
          <div class="read-status" *ngIf="message.senderId === user.id">
            <mat-icon *ngIf="message.isRead" class="read-icon">done_all</mat-icon>
            <mat-icon *ngIf="!message.isRead" class="unread-icon">done</mat-icon>
          </div>
        </div>
      </div>
    </div>

    <div class="content-footer">
      <mat-form-field appearance="outline" class="input-field">
        <input matInput [(ngModel)]="newMessage" placeholder="Type a message" (keyup.enter)="sendMessage()" />
        <button mat-icon-button matSuffix (click)="sendMessage()">
          <mat-icon>send</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>
</div>
